<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tables Page</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <style>
    .matchResult {
        border-radius: 5px;
        height: 200px;
        width: 200px;
        margin-left: auto;
        margin-right: auto;
        display: block;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1 class="text-center"><span class="glyphicon glyphicon-user"></span> Your Match <span class="glyphicon glyphicon-user">
            <br>
        </div>
        <div class="row">
         <div class="col-lg-1">
            </div>
            <div class="col-lg-4">
                <!-- Current Tables in Use -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">You</h4>
                    </div>
                    <div class="panel-body" id="you">
                        <img class="matchResult" id="yourImage" src="https://uwmccblog.files.wordpress.com/2017/01/image-placeholder-500x500.jpg?w=200">
                        <h3 id="userName"></h3>
                        <strong><p class="bio">AGE: <span id="userAge"></span> </p></strong>
                        <br>
                        <strong><p class="bio">SHORT BIO: <span id="userBio"></span> </p></strong>
                    </div>
                </div>
            </div>
              <div class="col-lg-2">
            </div>
            <div class="col-lg-4">
                <!-- Current Tables in Use -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Your match</h4>
                    </div>
                    <div class="panel-body">
                        <img src="https://uwmccblog.files.wordpress.com/2017/01/image-placeholder-500x500.jpg?w=200" class="matchResult" id="yourMatch">
                        <h3 id="matchName"></h3>
                        <strong><p class="bio">AGE: <span id="matchAge"></span></p></strong>
                        <br>
                        <strong><p class="bio">SHORT BIO: <span id="matchBio"></span></p></strong>
                    </div>
                </div>
            </div>
        </div>
        <!-- <footer class="footer">
            <div class="container">
                <p>Control Panel</p>
                <p><a href="#" id="clear">Clear Table</a> | <a href="/api/tables">API Table Link</a> | <a href="/api/waitlist">API Wait List</a> | <a href="https://github.com/afhaque/HotRestaurant">GitHub Repo</a></p>
            </div>
        </footer> -->
    </div>
    <script>
    // function Profile(name, imageUrl, leisureAvg, moralsAvg, interestsAvg, superficialityAvg, multiplyer, reducer) {
    //     this.name = name;
    //     this.imageUrl = imageUrl;
    //     this.leisureAvg = leisureAvg;
    //     this.moralsAvg = moralsAvg;
    //     this.interestsAvg = interestsAvg;
    //     this.superficialityAvg = superficialityAvg;
    //     this.multiplyer = multiplyer;
    //     this.reducer = reducer;
    // }

    // var categoryArray = ["leisure", "morals", "interests", "superficiality"];
    // for (var i = 0; i < n; i++) {
    //       for (var j = 0; j < 4; j++) {
    //           var maximizer = 1;
    //           var minimizer = 1;
    //           switch (true) {
    //               case (userDataObj.multiplyer === "leisure" && j === 0):
    //                   maximizer = 2;
    //                   break;
    //               case (userDataObj.multiplyer === "morals" && j === 1):
    //                   maximizer = 2;
    //                   console.log("moralsfire");
    //                   break;
    //               case (userDataObj.multiplyer === "interests" && j === 2):
    //                   maximizer = 2;
    //                   console.log("interestsfire");
    //                   break;
    //               case (userDataObj.multiplyer === "superficiality" && j === 3):
    //                   maximizer = 2;
    //                   console.log("superficialityfire");
    //                   break;
    //               default:
    //                   console.log("missedit")
    //                   break;
    //           }
    //           switch (true) {
    //               case (userDataObj.reducer === "leisure" && j === 0):
    //                   minimizer = 0.5;
    //                   console.log("leisurefire");
    //                   break;
    //               case (userDataObj.reducer === "morals" && j === 1):
    //                   minimizer = 0.5;
    //                   console.log("moralsfire");
    //                   break;
    //               case (userDataObj.reducer === "interests" && j === 2):
    //                   minimizer = 0.5;
    //                   console.log("interestsfire");
    //                   break;
    //               case (userDataObj.reducer === "superficiality" && j === 3):
    //                   minimizer = 0.5;
    //                   console.log("superficialityfire");
    //                   break;
    //               default:
    //                   console.log("missedit");
    //                   break;
    //           }
    //           var num = (Math.abs((dataArray[0][i].surveyResults[j].average) - (userDataObj.surveyResults[j].average)));

    //           var twoNum = num.toFixed(2);
    //           var scaled = 0;
    //           switch (true) {
    //               case (twoNum < 1):
    //                   scaled = 10 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 1 && twoNum < 2):
    //                   scaled = 8 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 2 && twoNum < 3):
    //                   scaled = 6 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 3 && twoNum < 4):
    //                   scaled = 5 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 4 && twoNum < 5):
    //                   scaled = 4 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 5 && twoNum < 6):
    //                   scaled = 2 * minimizer * maximizer;
    //                   break;
    //               case (twoNum >= 6):
    //                   scaled = 0;
    //                   break;
    //           }

    var dataArray = [];
    var userDataObj = "";
    var narrowedArray = [];
    var yourMatch;
    var scaled;
    $.ajax({
            url: "/api/friends",
            method: "GET"
        })
        .done(function(data) {
            var n = data.length;
            extractUserProfile();

            function extractUserProfile() {
                for (var i = 0; i < n; i++) {
                    if (i === n - 1) {
                        userDataObj = data[i];
                    } else {
                        dataArray.push(data[i]);
                    }
                }
                tossOut();
            }
        });


    //         narrowedArray[i].compatibilityScore += Math.abs(parseInt(userDataObj.moralsAverage) - narrowedArray[i].moralsAverage);
    //         narrowedArray[i].compatibilityScore += Math.abs(parseInt(userDataObj.interestsAverage) - narrowedArray[i].interestsAverage);
    //         narrowedArray[i].compatibilityScore += Math.abs(parseInt(userDataObj.superficialityAverage) - narrowedArray[i].superficialityAverage);


    // will toss out people who meet certain requirements
    function tossOut() {
        var userGender = userDataObj.gender;
        var userAgeRange = userDataObj.ageRange;
        var n = dataArray.length;
        for (var i = 0; i < n; i++) {
            if (dataArray[i].gender === userGender) {
                dataArray[i].removalTag = true;
            }
            switch (userAgeRange) {
                case "all":
                    break;
                case "younger":
                    if (dataArray[i].ageRange === "mid" || dataArray[i].ageRange === "older") {
                        dataArray[i].removalTag = true;
                    }
                    break;
                case "mid":
                    if (dataArray[i].ageRange === "younger" || dataArray[i].ageRange === "older") {
                        dataArray[i].removalTag = true;
                    }
                    break;
                case "older":
                    if (dataArray[i].ageRange === "younger" || dataArray[i].ageRange === "mid") {
                        dataArray[i].removalTag = true;
                    }
                    break;
            }
        }
        for (var i = 0; i < n; i++) {
            if (dataArray[i].removalTag != true) {
                narrowedArray.push(dataArray[i]);
            }
        }


        getCompatibilityScores();
    }

    var categoryArray = ["leisure", "morals", "interests", "superficiality"];

    function getCompatibilityScores() {
        var n = narrowedArray.length;
        for (var i = 0; i < n; i++) {
            for (var j = 0; j < 4; j++) {
                var maximizer = 1;
                var minimizer = 1;
                var num = 0;
                switch (true) {
                    case (userDataObj.multiplyer === "leisure" && j === 0):
                        maximizer = 2.5;
                        break;
                    case (userDataObj.multiplyer === "morals" && j === 1):
                        maximizer = 2.5;
                        console.log("moralsfire");
                        break;
                    case (userDataObj.multiplyer === "interests" && j === 2):
                        maximizer = 2.5;
                        console.log("interestsfire");
                        break;
                    case (userDataObj.multiplyer === "superficiality" && j === 3):
                        maximizer = 2.5;
                        console.log("superficialityfire");
                        break;
                    default:
                        break;
                }
                switch (true) {
                    case (userDataObj.reducer === "leisure" && j === 0):
                        minimizer = 0.5;
                        console.log("leisurefire");
                        break;
                    case (userDataObj.reducer === "morals" && j === 1):
                        minimizer = 0.5;
                        console.log("moralsfire");
                        break;
                    case (userDataObj.reducer === "interests" && j === 2):
                        minimizer = 0.5;
                        console.log("interestsfire");
                        break;
                    case (userDataObj.reducer === "superficiality" && j === 3):
                        minimizer = 0.5;
                        console.log("superficialityfire");
                        break;
                    default:
                        break;
                }
                // var num = (Math.abs((narrowedArray[i].surveyResults[j].average) - (userDataObj.surveyResults[j].average)));
                switch (true) {
                    case (j === 0):
                        num = Math.abs(parseInt(userDataObj.leisureAverage) - narrowedArray[i].leisureAverage);
                        break;
                    case (j === 1):
                        num = Math.abs(parseInt(userDataObj.moralsAverage) - narrowedArray[i].moralsAverage);
                        break;
                    case (j === 2):
                        num = Math.abs(parseInt(userDataObj.interestsAverage) - narrowedArray[i].interestsAverage);
                        break;
                    case (j === 3):
                        num = Math.abs(parseInt(userDataObj.superficialityAverage) - narrowedArray[i].superficialityAverage);
                        break;
                }

                var num = num.toFixed(2);
                var scaled = 0;
                switch (true) {
                    case (num < 1):
                        scaled = 10 * minimizer * maximizer;
                        break;
                    case (num >= 1 && num < 2):
                        scaled = 8 * minimizer * maximizer;
                        break;
                    case (num >= 2 && num < 3):
                        scaled = 6 * minimizer * maximizer;
                        break;
                    case (num >= 3 && num < 4):
                        scaled = 5 * minimizer * maximizer;
                        break;
                    case (num >= 4 && num < 5):
                        scaled = 4 * minimizer * maximizer;
                        break;
                    case (num >= 5 && num < 6):
                        scaled = 2 * minimizer * maximizer;
                        break;
                    case (num >= 6):
                        scaled = 0;
                        break;
                }

                narrowedArray[i].compatibilityScore += scaled;
            }
        }
        sortResults();
    }


    function sortResults() {
        var n = narrowedArray.length;
        var temp;
        for (var i = 0; i < n; i++) {
            for (var j = 0; j < n; j++) {
                if (j === n - 1) {
                    break;
                }
                if (narrowedArray[j].compatibilityScore > narrowedArray[j + 1].compatibilityScore) {
                    temp = narrowedArray[j];
                    narrowedArray[j] = narrowedArray[j + 1];
                    narrowedArray[j + 1] = temp;
                }
            }
        }

        displayMatchDetails();

    }


    function displayMatchDetails() {
        var n = narrowedArray.length;
        yourMatch = narrowedArray[n - 1];
        console.log(yourMatch.friendName);
        $("#matchName").html(yourMatch.friendName);
        $("#yourMatch").attr("src", yourMatch.imageUrl);
        $("#userName").html(userDataObj.friendName);
    }
    </script>
</body>

</html>
