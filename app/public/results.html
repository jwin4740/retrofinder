<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tables Page</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <style>
    .matchResult {
        border: solid 2px black;
        height: 200px;
        width: 200px;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <!-- Current Tables in Use -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">You</h4>
                    </div>
                    <div class="panel-body" id="you">
                        <img class="matchResult" id="yourImage" alt="https://www.ucl.ac.uk/prospective-students/graduate/images/test/placeholder-200x200">
                        <h3> name </h3>
                        <p> about me information and data that describes why the match is a good match</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <!-- Current Tables in Use -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">Your match</h4>
                    </div>
                    <div class="panel-body">
                        <img class="matchResult" id="yourMatch" alt="https://www.ucl.ac.uk/prospective-students/graduate/images/test/placeholder-200x200">
                        <h3> name </h3>
                        <p> about me information and data that describes why the match is a good match</p>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="container">
                <p>Control Panel</p>
                <p><a href="#" id="clear">Clear Table</a> | <a href="/api/tables">API Table Link</a> | <a href="/api/waitlist">API Wait List</a> | <a href="https://github.com/afhaque/HotRestaurant">GitHub Repo</a></p>
            </div>
        </footer>
    </div>
    <script>
    // function Profile(name, imageUrl, leisureAvg, moralsAvg, interestsAvg, superficialityAvg, multiplyer, reducer) {
    //     this.name = name;
    //     this.imageUrl = imageUrl;
    //     this.leisureAvg = leisureAvg;
    //     this.moralsAvg = moralsAvg;
    //     this.interestsAvg = interestsAvg;
    //     this.superficialityAvg = superficialityAvg;
    //     this.multiplyer = multiplyer;
    //     this.reducer = reducer;
    // }
    var finalMatchScore;
    var categoryArray = ["leisure", "morals", "interests", "superficiality"];
    var userDataArray = [];
    var dataArray = [];
    var matchScoreArray = [];
    var insertImage;
    $.ajax({
            url: "/api/friends",
            method: "GET"
        })
        .done(function(data) {
            insertImage = data[1].imageUrl;
            console.log(insertImage);
            $("#yourMatch").attr("src", insertImage);
            dataArray.push(data);
            getAverages();
            // calculates the average scores of a user in each category and updates the dataArray accordingly
            function getAverages() {
                var categorySumArray = [];
                var n = data.length;
                var m = 3; // raw data length
                var categorySumArray = [];
                for (var i = 0; i < n; i++) {
                    for (var j = 0; j < 4; j++) {
                        var categorySum = 0;
                        for (var k = 0; k < m; k++) {
                            categorySum += parseInt(data[i].surveyResults[j].raw[k]);
                        }
                        dataArray[0][i].surveyResults[j].average = (categorySum / m).toFixed(2);
                        if (i === n - 1) {
                            userDataArray.push(dataArray[0][i].surveyResults[j].average);
                        }
                        categorySumArray.push(categorySum);

                    }
                    console.log(categorySumArray);
                }
                setTimeout(getMatchScores, 1000);
                console.log(dataArray);

            }
        });

    function getMatchScores() {

        var n = dataArray[0].length - 1;
        var tempCompareArray = [];
        console.log(n);
        userDataObj = dataArray[0][n];
        console.log(userDataObj);
        var tempUserAverage;

        for (var i = 0; i < n; i++) {
            for (var j = 0; j < 4; j++) {
                var maximizer = 1;
                var minimizer = 1;
                switch (true) {
                    case (userDataObj.multiplyer === "leisure" && j === 0):
                        maximizer = 2;
                        break;
                    case (userDataObj.multiplyer === "morals" && j === 1):
                        maximizer = 2;
                        console.log("moralsfire");
                        break;
                    case (userDataObj.multiplyer === "interests" && j === 2):
                        maximizer = 2;
                        console.log("interestsfire");
                        break;
                    case (userDataObj.multiplyer === "superficiality" && j === 3):
                        maximizer = 2;
                        console.log("superficialityfire");
                        break;
                    default:
                        console.log("missedit")
                        break;
                }
                switch (true) {
                    case (userDataObj.reducer === "leisure" && j === 0):
                        minimizer = 0.5;
                        console.log("leisurefire");
                        break;
                    case (userDataObj.reducer === "morals" && j === 1):
                        minimizer = 0.5;
                        console.log("moralsfire");
                        break;
                    case (userDataObj.reducer === "interests" && j === 2):
                        minimizer = 0.5;
                        console.log("interestsfire");
                        break;
                    case (userDataObj.reducer === "superficiality" && j === 3):
                        minimizer = 0.5;
                        console.log("superficialityfire");
                        break;
                    default:
                        console.log("missedit");
                        break;
                }
                var num = minimizer * maximizer * (Math.abs((dataArray[0][i].surveyResults[j].average) - (userDataObj.surveyResults[j].average)));

                var twoNum = num.toFixed(2);
                tempCompareArray.push(twoNum);
            }
            console.log(tempCompareArray);


















        }
    }
    </script>
</body>

</html>
